# äº•å­—éŠæˆ²å¤šäººé€£ç·šæ¸¬è©¦æŒ‡å—

## ğŸ® å¤šäººé€£ç·šé‹ä½œæ©Ÿåˆ¶

### âœ… æ­£å¸¸æƒ…æ³

```
æƒ…å¢ƒ1ï¼šé›™äººé…å°
ç©å®¶A åŠ å…¥ â†’ å‰µå»ºæˆ¿é–“1 â†’ ç­‰å¾…å°æ‰‹
ç©å®¶B åŠ å…¥ â†’ åŠ å…¥æˆ¿é–“1 â†’ éŠæˆ²é–‹å§‹ âœ“

æƒ…å¢ƒ2ï¼šå¤šçµ„é…å°
ç©å®¶1 åŠ å…¥ â†’ å‰µå»ºæˆ¿é–“A â†’ ç­‰å¾…
ç©å®¶2 åŠ å…¥ â†’ åŠ å…¥æˆ¿é–“A â†’ é–‹å§‹éŠæˆ² âœ“
ç©å®¶3 åŠ å…¥ â†’ å‰µå»ºæˆ¿é–“B â†’ ç­‰å¾…
ç©å®¶4 åŠ å…¥ â†’ åŠ å…¥æˆ¿é–“B â†’ é–‹å§‹éŠæˆ² âœ“
ç©å®¶5 åŠ å…¥ â†’ å‰µå»ºæˆ¿é–“C â†’ ç­‰å¾…
ç©å®¶6 åŠ å…¥ â†’ åŠ å…¥æˆ¿é–“C â†’ é–‹å§‹éŠæˆ² âœ“
```

### ğŸ”’ å®‰å…¨æ©Ÿåˆ¶

1. **é˜²æ­¢é‡è¤‡åŠ å…¥**

   - ç©å®¶é‡è¤‡é»æ“Šã€ŒåŠ å…¥ PVPã€æ™‚ï¼Œæœƒè¿”å›ç•¶å‰æˆ¿é–“ç‹€æ…‹
   - ä¸æœƒå‰µå»ºå¤šå€‹æˆ¿é–“

2. **æˆ¿é–“å®¹é‡é™åˆ¶**

   ```python
   if len(self.players) >= 2:
       return False  # æˆ¿é–“å·²æ»¿
   ```

3. **è‡ªå‹•æ¸…ç†**
   - ç©å®¶æ–·ç·šæ™‚ï¼Œæˆ¿é–“æœƒç§»é™¤è©²ç©å®¶
   - æˆ¿é–“ç‚ºç©ºæ™‚ï¼Œè‡ªå‹•åˆªé™¤æˆ¿é–“

## ğŸ§ª æ¸¬è©¦å ´æ™¯

### æ¸¬è©¦ 1ï¼šåŸºæœ¬é…å°ï¼ˆ2 äººï¼‰

```
æ­¥é©Ÿï¼š
1. é–‹å•Ÿç€è¦½å™¨Aï¼Œç™»å…¥ç‚ºç©å®¶Aï¼Œé¸æ“‡PVPæ¨¡å¼
2. é–‹å•Ÿç€è¦½å™¨Bï¼Œç™»å…¥ç‚ºç©å®¶Bï¼Œé¸æ“‡PVPæ¨¡å¼
3. é©—è­‰ï¼šå…©ä½ç©å®¶é€²å…¥åŒä¸€æˆ¿é–“ï¼ŒéŠæˆ²é–‹å§‹

é æœŸçµæœï¼šâœ“ æ­£å¸¸é…å°ï¼ŒéŠæˆ²é–‹å§‹
```

### æ¸¬è©¦ 2ï¼šå¤šçµ„é…å°ï¼ˆ4 äººï¼‰

```
æ­¥é©Ÿï¼š
1. ç©å®¶AåŠ å…¥ â†’ ç­‰å¾…
2. ç©å®¶BåŠ å…¥ â†’ èˆ‡Aé…å° âœ“
3. ç©å®¶CåŠ å…¥ â†’ ç­‰å¾…ï¼ˆæ–°æˆ¿é–“ï¼‰
4. ç©å®¶DåŠ å…¥ â†’ èˆ‡Cé…å° âœ“

é æœŸçµæœï¼šâœ“ å½¢æˆå…©å€‹ç¨ç«‹æˆ¿é–“
```

### æ¸¬è©¦ 3ï¼šé‡è¤‡åŠ å…¥

```
æ­¥é©Ÿï¼š
1. ç©å®¶Aé»æ“Šã€ŒåŠ å…¥PVPã€
2. ç©å®¶Aå†æ¬¡é»æ“Šã€ŒåŠ å…¥PVPã€

é æœŸçµæœï¼šâœ“ è¿”å›åŸæˆ¿é–“ç‹€æ…‹ï¼Œä¸å‰µå»ºæ–°æˆ¿é–“
```

### æ¸¬è©¦ 4ï¼šç©å®¶é›¢é–‹

```
æ­¥é©Ÿï¼š
1. ç©å®¶Aå’ŒBæ­£åœ¨éŠæˆ²
2. ç©å®¶Aé—œé–‰ç€è¦½å™¨
3. æª¢æŸ¥ç©å®¶Bçš„ç•«é¢

é æœŸçµæœï¼šâœ“ ç©å®¶Bæ”¶åˆ°ã€Œå°æ‰‹é›¢é–‹ã€é€šçŸ¥
```

### æ¸¬è©¦ 5ï¼šå–®äººç­‰å¾…è¶…æ™‚

```
æ­¥é©Ÿï¼š
1. ç©å®¶AåŠ å…¥PVP
2. é•·æ™‚é–“æ²’æœ‰å…¶ä»–ç©å®¶åŠ å…¥

é æœŸçµæœï¼šâœ“ ç©å®¶AæŒçºŒç­‰å¾…ï¼ˆå¯è€ƒæ…®æ·»åŠ è¶…æ™‚æ©Ÿåˆ¶ï¼‰
```

## âš ï¸ æ½›åœ¨å•é¡Œèˆ‡å»ºè­°

### 1. è¨˜æ†¶é«”ç®¡ç†

**å•é¡Œï¼š** é•·æœŸé‹è¡Œå¯èƒ½ç´¯ç©ç©ºæˆ¿é–“

**å»ºè­°ï¼š** æ·»åŠ æˆ¿é–“è¶…æ™‚æ¸…ç†

```python
# å»ºè­°åœ¨ RoomManager ä¸­æ·»åŠ 
def clean_timeout_rooms(self, timeout_seconds=300):
    """æ¸…ç†è¶…é5åˆ†é˜çš„ç­‰å¾…æˆ¿é–“"""
    current_time = time.time()
    rooms_to_delete = []

    for room_id, room in self.rooms.items():
        if room.waiting and (current_time - room.created_at) > timeout_seconds:
            rooms_to_delete.append(room_id)

    for room_id in rooms_to_delete:
        self.delete_room(room_id)
```

### 2. æˆ¿é–“ç‹€æ…‹ç›£æ§

**å»ºè­°ï¼š** æ·»åŠ ç®¡ç†å“¡é é¢é¡¯ç¤ºï¼š

- ç•¶å‰æˆ¿é–“æ•¸é‡
- ç­‰å¾…ä¸­çš„æˆ¿é–“æ•¸
- é€²è¡Œä¸­çš„éŠæˆ²æ•¸
- ç·šä¸Šç©å®¶æ•¸

```python
@app.route('/admin/rooms')
def admin_rooms():
    return jsonify({
        'total_rooms': room_manager.get_room_count(),
        'waiting_rooms': room_manager.get_waiting_room_count(),
        'active_rooms': room_manager.get_active_room_count()
    })
```

### 3. é‡é€£æ©Ÿåˆ¶

**å•é¡Œï¼š** ç©å®¶ç¶²è·¯æ–·ç·šå¾Œç„¡æ³•å›åˆ°åŸæˆ¿é–“

**å»ºè­°ï¼š** æ·»åŠ é‡é€£åŠŸèƒ½

```python
# ä¿å­˜æˆ¿é–“ç‹€æ…‹åˆ° session
# æ–·ç·šé‡é€£æ™‚æª¢æŸ¥ä¸¦æ¢å¾©
```

### 4. æˆ¿é–“ ID è¡çª

**ç›®å‰ï¼š** ä½¿ç”¨ `room_{sid[:8]}_{random.randint(1000, 9999)}`

**é¢¨éšªï¼š** æ¥µä½æ©Ÿç‡çš„ ID è¡çª

**å»ºè­°ï¼š** ä½¿ç”¨ UUID

```python
import uuid
room_id = f"room_{uuid.uuid4().hex[:12]}"
```

## ğŸ“Š å£“åŠ›æ¸¬è©¦å»ºè­°

```python
# æ¨¡æ“¬100å€‹ç©å®¶åŒæ™‚é€£ç·š
import threading
import socketio

def simulate_player(player_id):
    sio = socketio.Client()
    sio.connect('http://localhost:5000')
    # ä½¿ç”¨ action JSON æ ¼å¼ä»¥é…åˆå‰å¾Œç«¯å”è­°
    sio.emit('action', {'action': 'join_pvp'})
    # ... ç­‰å¾…éŠæˆ²

threads = []
for i in range(100):
    t = threading.Thread(target=simulate_player, args=(i,))
    threads.append(t)
    t.start()
```

## âœ… çµè«–

**ç›®å‰çš„è¨­è¨ˆå¯ä»¥æ”¯æ´å¤šäººé€£ç·šï¼**

- âœ… è‡ªå‹•é…å°æˆå¤šå€‹æˆ¿é–“
- âœ… æˆ¿é–“å®¹é‡é™åˆ¶ï¼ˆ2 äººï¼‰
- âœ… é˜²æ­¢é‡è¤‡åŠ å…¥
- âœ… è‡ªå‹•æ¸…ç†ç©ºæˆ¿é–“

**å»ºè­°æ”¹é€²ï¼š**

- æ·»åŠ æˆ¿é–“è¶…æ™‚æ¸…ç†
- æ·»åŠ ç›£æ§çµ±è¨ˆåŠŸèƒ½
- è€ƒæ…®æ·»åŠ é‡é€£æ©Ÿåˆ¶
